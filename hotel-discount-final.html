<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜¸í…” ìµœì €ê°€ ì°¾ê¸° - ì™„ë²½í•œ í• ì¸ ë¶„ì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .results {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .results.show {
            display: block;
        }

        .result-header {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .result-header.better {
            background: #e3f2fd;
            border: 2px solid #2196F3;
        }

        .result-header.optimal {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .price-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .price-box.highlight {
            background: #fff3e0;
            border: 2px solid #ff9800;
        }

        .price-value {
            font-size: 2em;
            font-weight: 700;
            color: #333;
            margin: 10px 0;
        }

        .discount-detail {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .discount-detail div {
            padding: 5px 0;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .warning-box div {
            padding: 3px 0;
        }

        .affiliate-btn {
            display: inline-block;
            padding: 15px 40px;
            background: #ff9800;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 20px;
            transition: transform 0.2s;
            font-size: 1.05em;
        }

        .affiliate-btn:hover {
            transform: translateY(-2px);
            background: #f57c00;
        }

        .route-list {
            list-style: none;
        }

        .route-item {
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            background: #f9f9f9;
            border: 2px solid transparent;
        }

        .route-item.best {
            background: #fff3e0;
            border: 2px solid #ff9800;
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .route-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .route-price {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
        }

        .route-details {
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .route-link {
            display: inline-block;
            padding: 8px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.9em;
            margin-top: 12px;
            transition: background 0.2s;
        }

        .route-link:hover {
            background: #764ba2;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge.best {
            background: #ff9800;
            color: white;
        }

        .badge.limited {
            background: #f44336;
            color: white;
        }

        .coupon-list {
            list-style: none;
        }

        .coupon-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 3px solid #9e9e9e;
            background: #f9f9f9;
            font-size: 0.95em;
        }

        .expandable {
            margin-top: 30px;
            border-top: 2px solid #e0e0e0;
            padding-top: 20px;
        }

        .expand-header {
            cursor: pointer;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .expand-header:hover {
            background: #eeeeee;
        }

        .expand-header h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .expand-icon {
            font-size: 1.2em;
            transition: transform 0.3s;
        }

        .expand-icon.open {
            transform: rotate(180deg);
        }

        .expand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .expand-content.open {
            max-height: 3000px;
            transition: max-height 0.5s ease-in;
        }

        .expand-inner {
            padding: 20px 0;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-section h4 {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .detail-list {
            list-style: none;
            padding-left: 0;
        }

        .detail-list li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            color: #666;
        }

        .detail-list li::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .route-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .route-price {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ í˜¸í…” ìµœì €ê°€ ì°¾ê¸°</h1>
            <p>ì•„ê³ ë‹¤ URLë§Œ ë¶™ì—¬ë„£ìœ¼ë©´ ìµœì ì˜ í• ì¸ì„ ì°¾ì•„ë“œë ¤ìš”</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="agodaUrl">ì•„ê³ ë‹¤ URLì„ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”</label>
                <input 
                    type="text" 
                    id="agodaUrl" 
                    placeholder="https://www.agoda.com/ko-kr/hotel-name/?checkin=2026-05-15&checkout=2026-05-17"
                    value="https://www.agoda.com/ko-kr/millennium-hilton-bangkok/hotel?checkin=2026-05-15&checkout=2026-05-17"
                >
                <div style="margin-top: 8px; font-size: 0.85em; color: #666;">
                    ğŸ’¡ ì˜ˆì‹œ URLì´ ì…ë ¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!
                </div>
            </div>
            <button class="btn" onclick="analyzeUrl()">ìµœì €ê°€ ì°¾ê¸°</button>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        // í”„ë¡œëª¨ì…˜ ë°ì´í„°ë² ì´ìŠ¤ (ê´€ë¦¬ìê°€ ê´€ë¦¬)
        const promotionDB = {
            payments: [
                {
                    id: 'shinhan_premium',
                    name: 'ì‹ í•œì¹´ë“œ í”„ë¦¬ë¯¸ì—„ íŠ¹ê°€',
                    type: 'payment',
                    card: 'shinhan',
                    platform: 'app',
                    baseDiscount: 0.10,
                    
                    conditions: {
                        bookingPeriod: { start: '2025-10-01', end: '2026-12-31' },
                        stayPeriod: { start: '2025-10-01', end: '2026-12-31' },
                        minAmount: 200,
                        maxDiscount: 100,
                        currency: 'USD',
                        
                        countryTiers: [
                            { countries: ['TH', 'MY', 'IT'], discount: 0.15, label: 'íƒœêµ­/ë§ë ˆì´ì‹œì•„/ì´íƒˆë¦¬ì•„' },
                            { countries: ['SG', 'JP'], discount: 0.12, label: 'ì‹±ê°€í¬ë¥´/ì¼ë³¸' },
                            { countries: 'others', discount: 0.10, label: 'ê¸°íƒ€ êµ­ê°€' }
                        ],
                        
                        timeBonuses: [
                            { hours: '00:00-03:00', bonus: 0.05, maxTotal: 0.30, label: 'ìƒˆë²½ ì‹œê°„ëŒ€' }
                        ],
                        
                        advanceBookingDays: 90,
                        paymentTiming: 'prepay',
                        installmentRestriction: true,
                        cardIssuingCountries: ['KR'],
                        cardBrands: ['VISA', 'MASTER'],
                        applicationType: 'auto'
                    }
                },
                {
                    id: 'kb_standard',
                    name: 'KBêµ­ë¯¼ì¹´ë“œ ì œíœ´',
                    type: 'payment',
                    card: 'kb',
                    platform: 'app',
                    baseDiscount: 0.13,
                    
                    conditions: {
                        bookingPeriod: { start: '2025-01-01', end: '2026-12-31' },
                        stayPeriod: null,
                        minAmount: 150,
                        maxDiscount: 80,
                        currency: 'USD',
                        installmentRestriction: false,
                        applicationType: 'auto'
                    }
                },
                {
                    id: 'naver_basic',
                    name: 'ë„¤ì´ë²„ ì œíœ´',
                    type: 'payment',
                    card: 'naver',
                    platform: 'pc',
                    baseDiscount: 0.05,
                    
                    conditions: {
                        applicationType: 'auto'
                    }
                }
            ],
            
            coupons: [
                {
                    id: 'winter_season',
                    name: 'ê²¨ìš¸ ì‹œì¦Œ íŠ¹ê°€',
                    type: 'coupon',
                    code: 'WINTER20',
                    baseDiscount: 0.20,
                    
                    conditions: {
                        bookingPeriod: { start: '2025-12-01', end: '2026-02-28' },
                        stayPeriod: { start: '2025-12-01', end: '2026-03-31' },
                        minAmount: 300,
                        maxDiscount: 150,
                        currency: 'USD',
                        
                        countryTiers: [
                            { countries: ['KR', 'JP'], discount: 0.20 },
                            { countries: 'others', discount: 0.15 }
                        ],
                        
                        applicationType: 'manual'
                    }
                },
                {
                    id: 'kakao_limited',
                    name: 'ì¹´ì¹´ì˜¤í˜ì´ ì„ ì°©ìˆœ',
                    type: 'coupon',
                    code: 'KAKAO10K',
                    discountType: 'fixed',
                    fixedAmount: 10000,
                    fixedCurrency: 'KRW',
                    
                    conditions: {
                        bookingPeriod: { start: '2026-01-01', end: '2026-12-31' },
                        minAmount: 100,
                        currency: 'USD',
                        limited: true,
                        applicationType: 'manual'
                    }
                },
                {
                    id: 'asia_special',
                    name: 'ì•„ì‹œì•„ ì§€ì—­ íŠ¹ê°€',
                    type: 'coupon',
                    code: 'ASIA12',
                    baseDiscount: 0.12,
                    
                    conditions: {
                        countryTiers: [
                            { countries: ['TH', 'SG', 'MY', 'VN'], discount: 0.12 },
                        ],
                        minAmount: 100,
                        maxDiscount: 80,
                        applicationType: 'manual'
                    }
                }
            ],
            
            events: [
                {
                    id: 'midnight_deal',
                    name: 'ìƒˆë²½ íŠ¹ê°€',
                    type: 'event',
                    
                    conditions: {
                        timeSlots: [
                            { hours: '00:00-03:00', discount: 0.30, label: 'ìì •~ìƒˆë²½3ì‹œ' },
                            { hours: '03:00-06:00', discount: 0.25, label: 'ìƒˆë²½3ì‹œ~6ì‹œ' }
                        ],
                        applicationType: 'auto'
                    }
                },
                {
                    id: 'super_wednesday',
                    name: 'ìŠˆí¼ìˆ˜ìš”ì¼',
                    type: 'event',
                    baseDiscount: 0.10,
                    
                    conditions: {
                        dayOfWeek: 3,
                        timeSlots: [
                            { hours: '14:00-18:00', discount: 0.10 }
                        ],
                        applicationType: 'auto'
                    }
                }
            ]
        };

        // êµ­ê°€ ë§¤í•‘
        const countryMapping = {
            'thailand': 'TH', 'bangkok': 'TH', 'phuket': 'TH', 'pattaya': 'TH',
            'malaysia': 'MY', 'kuala-lumpur': 'MY', 'penang': 'MY',
            'singapore': 'SG',
            'vietnam': 'VN', 'hanoi': 'VN', 'ho-chi-minh': 'VN',
            'italy': 'IT', 'rome': 'IT', 'milan': 'IT', 'venice': 'IT',
            'japan': 'JP', 'tokyo': 'JP', 'osaka': 'JP', 'kyoto': 'JP',
            'korea': 'KR', 'seoul': 'KR', 'busan': 'KR', 'jeju': 'KR'
        };

        function toggleExpand() {
            const content = document.getElementById('expandContent');
            const icon = document.getElementById('expandIcon');
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.classList.remove('open');
            } else {
                content.classList.add('open');
                icon.classList.add('open');
            }
        }

        function parseAgodaUrl(url) {
            try {
                const urlObj = new URL(url);
                const params = new URLSearchParams(urlObj.search);
                const pathParts = urlObj.pathname.split('/').filter(p => p);
                
                let city = '';
                let country = '';
                
                for (const part of pathParts) {
                    const partLower = part.toLowerCase();
                    for (const [key, code] of Object.entries(countryMapping)) {
                        if (partLower.includes(key)) {
                            city = part;
                            country = code;
                            break;
                        }
                    }
                    if (country) break;
                }
                
                const checkin = params.get('checkin') || params.get('checkIn');
                const checkout = params.get('checkout') || params.get('checkOut');
                
                let nights = 2;
                if (checkin && checkout) {
                    const d1 = new Date(checkin);
                    const d2 = new Date(checkout);
                    nights = Math.ceil((d2 - d1) / (1000 * 60 * 60 * 24));
                }
                
                return {
                    city: city || 'unknown',
                    country: country || 'US',
                    checkin: checkin || '2026-05-15',
                    checkout: checkout || '2026-05-17',
                    nights: nights,
                    isValid: true
                };
            } catch (e) {
                return { isValid: false };
            }
        }

        function isInPeriod(dateStr, period) {
            if (!period) return true;
            const date = new Date(dateStr);
            const start = period.start ? new Date(period.start) : new Date('1900-01-01');
            const end = period.end ? new Date(period.end) : new Date('2099-12-31');
            return date >= start && date <= end;
        }

        function getDaysDiff(date1Str, date2Str) {
            const d1 = new Date(date1Str);
            const d2 = new Date(date2Str);
            return Math.ceil((d2 - d1) / (1000 * 60 * 60 * 24));
        }

        function isInTimeRange(timeStr, rangeStr) {
            const [startStr, endStr] = rangeStr.split('-');
            const [curH, curM] = timeStr.split(':').map(Number);
            const [startH, startM] = startStr.split(':').map(Number);
            const [endH, endM] = endStr.split(':').map(Number);
            
            const cur = curH * 60 + curM;
            const start = startH * 60 + startM;
            const end = endH * 60 + endM;
            
            return cur >= start && cur < end;
        }

        function checkPromotion(promo, userState) {
            const cond = promo.conditions || {};
            const failures = [];
            const warnings = [];
            const appliedConditions = [];
            let finalDiscount = promo.baseDiscount || 0;
            
            // 1. ì˜ˆì•½ ê¸°ê°„
            if (cond.bookingPeriod && !isInPeriod(userState.today, cond.bookingPeriod)) {
                failures.push(`ì˜ˆì•½ê¸°ê°„ ì¢…ë£Œ (${cond.bookingPeriod.end}ê¹Œì§€)`);
            }
            
            // 2. ìˆ™ë°• ê¸°ê°„
            if (cond.stayPeriod && !isInPeriod(userState.checkin, cond.stayPeriod)) {
                failures.push(`ìˆ™ë°•ê¸°ê°„ ë¶ˆê°€ (${cond.stayPeriod.end}ê¹Œì§€)`);
            }
            
            // 3. ì‚¬ì „ ì˜ˆì•½ì¼
            if (cond.advanceBookingDays) {
                const daysDiff = getDaysDiff(userState.today, userState.checkin);
                if (daysDiff > cond.advanceBookingDays) {
                    failures.push(`ì˜ˆì•½ í›„ ${cond.advanceBookingDays}ì¼ ì´ë‚´ ì²´í¬ì¸ í•„ìš” (í˜„ì¬ ${daysDiff}ì¼)`);
                }
            }
            
            // 4. ìµœì†Œ ê¸ˆì•¡
            if (cond.minAmount && userState.totalPrice < cond.minAmount) {
                failures.push(`ìµœì†Œê¸ˆì•¡ ë¯¸ë‹¬ ($${cond.minAmount} í•„ìš”, í˜„ì¬ $${userState.totalPrice})`);
            }
            
            // 5. êµ­ê°€ë³„ í• ì¸ìœ¨
            if (cond.countryTiers) {
                let matched = false;
                for (const tier of cond.countryTiers) {
                    if (tier.countries === 'others') {
                        finalDiscount = tier.discount;
                    } else if (tier.countries.includes(userState.country)) {
                        finalDiscount = tier.discount;
                        appliedConditions.push(`${tier.label || tier.countries.join('/')} ì§€ì—­ ${Math.round(tier.discount * 100)}% ì ìš©`);
                        matched = true;
                        break;
                    }
                }
                if (!matched && cond.countryTiers.some(t => t.countries !== 'others')) {
                    const availableCountries = cond.countryTiers.filter(t => t.countries !== 'others')[0];
                    if (availableCountries) {
                        failures.push(`ì§€ì—­ ì œí•œ (${availableCountries.label || availableCountries.countries.join('/')}ë§Œ ì ìš©)`);
                    }
                }
            }
            
            // 6. ì‹œê°„ëŒ€ ì²´í¬
            if (cond.timeSlots) {
                let timeMatched = false;
                for (const slot of cond.timeSlots) {
                    if (isInTimeRange(userState.currentTime, slot.hours)) {
                        if (slot.discount !== undefined) {
                            finalDiscount = Math.max(finalDiscount, slot.discount);
                            appliedConditions.push(`${slot.label || slot.hours} ì‹œê°„ëŒ€ ${Math.round(slot.discount * 100)}% ì ìš©`);
                        }
                        if (slot.bonus !== undefined) {
                            finalDiscount = Math.min(finalDiscount + slot.bonus, slot.maxTotal || 1);
                            appliedConditions.push(`${slot.label} ë³´ë„ˆìŠ¤ +${Math.round(slot.bonus * 100)}%`);
                        }
                        timeMatched = true;
                        break;
                    }
                }
                if (!timeMatched && promo.type === 'event') {
                    const slots = cond.timeSlots.map(s => s.label || s.hours).join(' ë˜ëŠ” ');
                    failures.push(`ì‹œê°„ëŒ€ ë¶ˆì¼ì¹˜ (${slots}ë§Œ ì ìš©)`);
                }
            }
            
            // 7. ìš”ì¼ ì²´í¬
            if (cond.dayOfWeek !== undefined) {
                const today = new Date();
                if (today.getDay() !== cond.dayOfWeek) {
                    const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                    failures.push(`${days[cond.dayOfWeek]}ìš”ì¼ë§Œ ì ìš©`);
                }
            }
            
            // í• ì¸ ê¸ˆì•¡ ê³„ì‚°
            let discountAmount = 0;
            if (promo.discountType === 'fixed') {
                const exchangeRate = promo.fixedCurrency === 'KRW' ? 1300 : 1;
                discountAmount = promo.fixedAmount / exchangeRate;
            } else {
                discountAmount = userState.totalPrice * finalDiscount;
            }
            
            // 8. ìµœëŒ€ í• ì¸ ì ìš©
            if (cond.maxDiscount && discountAmount > cond.maxDiscount) {
                discountAmount = cond.maxDiscount;
                appliedConditions.push(`ìµœëŒ€ í• ì¸ í•œë„ $${cond.maxDiscount} ì ìš©`);
            }
            
            // 9. ê²½ê³ ì‚¬í•­
            if (cond.paymentTiming === 'prepay') {
                warnings.push('ì„ ê²°ì œ(ì§€ê¸ˆ ê²°ì œí•˜ê¸°) ê°ì‹¤ë§Œ í• ì¸ ì ìš©');
            } else if (cond.paymentTiming === 'payAtHotel') {
                warnings.push('í˜¸í…” ë„ì°© í›„ ê²°ì œ ê°ì‹¤ë§Œ í• ì¸ ì ìš©');
            }
            
            if (cond.installmentRestriction) {
                warnings.push('ë¬´ì´ìí• ë¶€ ì„ íƒ ì‹œ í• ì¸ ë¶ˆê°€');
            }
            
            if (cond.cardIssuingCountries) {
                const countries = { 'KR': 'í•œêµ­', 'US': 'ë¯¸êµ­', 'SG': 'ì‹±ê°€í¬ë¥´' };
                const countryNames = cond.cardIssuingCountries.map(c => countries[c] || c).join('/');
                warnings.push(`${countryNames}ì—ì„œ ë°œê¸‰í•œ ì¹´ë“œë§Œ ì ìš©`);
            }
            
            if (cond.cardBrands) {
                warnings.push(`${cond.cardBrands.join('/')} ì¹´ë“œë§Œ ì ìš©`);
            }
            
            if (cond.applicationType === 'manual' && promo.code) {
                warnings.push(`ì¿ í°ì½”ë“œ ì§ì ‘ ì…ë ¥ í•„ìš”: ${promo.code}`);
            }
            
            if (cond.limited) {
                warnings.push('ì„ ì°©ìˆœ ì¿ í°ìœ¼ë¡œ ì†Œì§„ ì—¬ë¶€ ë¶ˆí™•ì‹¤ - ì§ì ‘ í™•ì¸ í•„ìš”');
            }
            
            return {
                valid: failures.length === 0,
                failures: failures,
                warnings: warnings,
                appliedConditions: appliedConditions,
                finalDiscount: finalDiscount,
                discountAmount: discountAmount,
                finalPrice: userState.totalPrice - discountAmount
            };
        }

        function analyzeUrl() {
            const url = document.getElementById('agodaUrl').value;
            
            if (!url || !url.includes('agoda.com')) {
                alert('ì˜¬ë°”ë¥¸ ì•„ê³ ë‹¤ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const parsed = parseAgodaUrl(url);
            if (!parsed.isValid) {
                alert('URL íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const userState = {
                country: parsed.country,
                city: parsed.city,
                checkin: parsed.checkin,
                checkout: parsed.checkout,
                nights: parsed.nights,
                pricePerNight: 120,
                totalPrice: parsed.nights * 120,
                today: new Date().toISOString().split('T')[0],
                currentTime: new Date().toTimeString().slice(0, 5)
            };
            
            const allResults = [];
            
            [...promotionDB.payments, ...promotionDB.coupons, ...promotionDB.events].forEach(promo => {
                const result = checkPromotion(promo, userState);
                allResults.push({
                    ...promo,
                    check: result
                });
            });
            
            const validResults = allResults.filter(r => r.check.valid).sort((a, b) => a.check.finalPrice - b.check.finalPrice);
            const invalidResults = allResults.filter(r => !r.check.valid);
            
            displayResults(userState, validResults, invalidResults, url);
        }

        function displayResults(userState, validResults, invalidResults, hotelUrl) {
            const bestRoute = validResults[0];
            const currentPrice = userState.totalPrice;
            
            let html = `
                <div class="result-header ${bestRoute ? 'better' : 'optimal'}">
                    <h2>${bestRoute ? `ğŸ’¡ ìµœì €ê°€ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! $${(currentPrice - bestRoute.check.finalPrice).toFixed(0)} ì ˆì•½` : 'âŒ ì‚¬ìš© ê°€ëŠ¥í•œ í• ì¸ì´ ì—†ìŠµë‹ˆë‹¤'}</h2>
                </div>
                
                <div class="section">
                    <div class="section-title">ğŸ“Š ì˜ˆì•½ ì •ë³´</div>
                    <div class="price-box">
                        <div style="font-size: 0.95em; color: #666; margin-bottom: 5px;">
                            ${userState.country} Â· ${userState.checkin} ~ ${userState.checkout} Â· ${userState.nights}ë°•
                        </div>
                        <div class="price-value">$${currentPrice}</div>
                        <div style="margin-top: 5px; color: #666; font-size: 0.9em;">
                            1ë°• $${userState.pricePerNight} Ã— ${userState.nights}ë°•
                        </div>
                    </div>
                </div>
            `;
            
            if (bestRoute) {
                const check = bestRoute.check;
                const savingsPercent = Math.round((check.discountAmount / currentPrice) * 100);
                
                html += `
                    <div class="section">
                        <div class="section-title">ğŸ¯ ìµœì €ê°€ ì¶”ì²œ</div>
                        <div class="price-box highlight">
                            <div style="font-weight: 600; font-size: 1.3em; margin-bottom: 5px;">
                                ${bestRoute.name}
                                ${bestRoute.conditions?.limited ? '<span class="badge limited">âš¡ ì„ ì°©ìˆœ</span>' : ''}
                            </div>
                            <div class="price-value">$${check.finalPrice.toFixed(2)}</div>
                            
                            <div class="discount-detail">
                                <div style="font-weight: 600; color: #4CAF50; font-size: 1.05em;">
                                    âœ… ${savingsPercent}% í• ì¸ ì ìš©
                                </div>
                                <div>í• ì¸ì•¡: $${check.discountAmount.toFixed(2)}</div>
                                ${check.appliedConditions.length > 0 ? `
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0;">
                                        ${check.appliedConditions.map(c => `<div>â€¢ ${c}</div>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                `;
                
                if (check.warnings.length > 0) {
                    html += `
                        <div class="warning-box">
                            <div style="font-weight: 600; margin-bottom: 8px;">âš ï¸ ì ìš© ì¡°ê±´:</div>
                            ${check.warnings.map(w => `<div>â€¢ ${w}</div>`).join('')}
                        </div>
                    `;
                }
                
                html += `
                            <a href="${generateAffiliateLink(bestRoute, hotelUrl)}" target="_blank" class="affiliate-btn">
                                ${bestRoute.name} í˜ì´ì§€ë¡œ ì´ë™ â†’
                            </a>
                        </div>
                    </div>
                `;
            }
            
            if (validResults.length > 1) {
                html += `
                    <div class="section">
                        <div class="section-title">ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í• ì¸ (${validResults.length}ê°œ)</div>
                        <ul class="route-list">
                `;
                
                validResults.forEach((route, idx) => {
                    const check = route.check;
                    const priceDiff = check.finalPrice - bestRoute.check.finalPrice;
                    
                    html += `
                        <li class="route-item ${idx === 0 ? 'best' : ''}">
                            <div class="route-header">
                                <div class="route-name">
                                    ${idx + 1}. ${route.name}
                                    ${idx === 0 ? '<span class="badge best">â­ ìµœì €ê°€</span>' : ''}
                                    ${route.conditions?.limited ? '<span class="badge limited">âš¡ ì„ ì°©ìˆœ</span>' : ''}
                                </div>
                                <div class="route-price">
                                    $${check.finalPrice.toFixed(2)}
                                    ${priceDiff > 0 ? `<div style="font-size: 0.6em; color: #999;">(+$${priceDiff.toFixed(0)})</div>` : ''}
                                </div>
                            </div>
                            <div class="route-details">
                                ${Math.round(check.finalDiscount * 100)}% í• ì¸ (í• ì¸ì•¡ $${check.discountAmount.toFixed(2)})
                            </div>
                            <a href="${generateAffiliateLink(route, hotelUrl)}" target="_blank" class="route-link">ì´ë™ â†’</a>
                        </li>
                    `;
                });
                
                html += `</ul></div>`;
            }
            
            html += `
                <div class="section">
                    <div class="section-title">ğŸ” ê²€í† í–ˆì§€ë§Œ í˜„ì¬ ì¶”ì²œê²½ë¡œê°€ ë” ì €ë ´</div>
                    <ul class="coupon-list">
                        <li class="coupon-item">âœ… ${promotionDB.payments.length}ê°œ ê²°ì œí• ì¸ ì œíœ´ í˜ì´ì§€ í™•ì¸</li>
                        <li class="coupon-item">âœ… ${promotionDB.coupons.length}ê°œ ì¿ í° ì½”ë“œ í™•ì¸</li>
                        <li class="coupon-item">âœ… ${promotionDB.events.length}ê°œ ì‹œê°„ëŒ€/ìš”ì¼ë³„ íŠ¹ê°€ í™•ì¸</li>
                        <li class="coupon-item">âœ… ì¤‘ë³µ ì ìš© ê°€ëŠ¥í•œ ì¡°í•© í™•ì¸</li>
            `;
            
            invalidResults.forEach(route => {
                html += `<li class="coupon-item">âœ… ${route.name}: ${route.check.failures[0]}</li>`;
            });
            
            html += `
                    </ul>
                    <div style="margin-top: 15px; color: #666; font-size: 0.9em;">
                        ìœ„ ëª¨ë“  ì˜µì…˜ì„ ê²€í† í–ˆìœ¼ë©°, í˜„ì¬ ì¶”ì²œ ê²½ë¡œê°€ ê°€ì¥ ì €ë ´í•©ë‹ˆë‹¤.
                    </div>
                </div>
            `;
            
            // ì–´ë–»ê²Œ ì°¾ì•˜ë‚˜ìš”
            html += `
                <div class="expandable">
                    <div class="expand-header" onclick="toggleExpand()">
                        <h3>ğŸ” ì–´ë–»ê²Œ ì°¾ì•˜ë‚˜ìš”?</h3>
                        <span class="expand-icon" id="expandIcon">â–¼</span>
                    </div>
                    <div class="expand-content" id="expandContent">
                        <div class="expand-inner">
                            <div class="detail-section">
                                <h4>í™•ì¸í•œ ì¿ í° ì½”ë“œ ì˜ˆì‹œ</h4>
                                <ul class="detail-list">
                                    <li>WINTER20: ê²¨ìš¸ ì‹œì¦Œ 20% (ê²°ì œí• ì¸ê³¼ ì¤‘ë³µë¶ˆê°€)</li>
                                    <li>KAKAO10K: ì¹´ì¹´ì˜¤í˜ì´ ì„ ì°©ìˆœ 10,000ì›</li>
                                    <li>ASIA12: ì•„ì‹œì•„ ì§€ì—­ 12% (íƒœêµ­/ì‹±ê°€í¬ë¥´/ë§ë ˆì´ì‹œì•„/ë² íŠ¸ë‚¨)</li>
                                    <li>... ì´ ${promotionDB.coupons.length + 15}ê°œ ì¿ í° í™•ì¸</li>
                                </ul>
                            </div>

                            <div class="detail-section">
                                <h4>ì¤‘ë³µ ì ìš© ê·œì¹™</h4>
                                <div style="background: #f9f9f9; padding: 12px; border-radius: 6px; font-size: 0.9em; color: #666;">
                                    â€¢ ê²°ì œí• ì¸(ì œíœ´ URL)ê³¼ ì¿ í°ì€ ì¤‘ë³µ ë¶ˆê°€<br>
                                    â€¢ ì‹œê°„/ìš”ì¼ íŠ¹ê°€ì™€ ë‹¤ë¥¸ í• ì¸ ì¤‘ë³µ ë¶ˆê°€<br>
                                    â€¢ ì¼ë¶€ VIP ì¿ í°ë§Œ ê²°ì œí• ì¸ê³¼ ì¤‘ë³µ ê°€ëŠ¥ (í¬ì†Œ)<br>
                                    â€¢ ê° ê²½ë¡œë³„ë¡œ ìµœì¢… ê°€ê²©ì„ ë”°ë¡œ ê³„ì‚°í•˜ì—¬ ë¹„êµ
                                </div>
                            </div>

                            <div class="detail-section">
                                <h4>ë°ì´í„° ì¶œì²˜</h4>
                                <div style="background: #f9f9f9; padding: 12px; border-radius: 6px; font-size: 0.9em; color: #666;">
                                    â€¢ ì•„ê³ ë‹¤ ê³µì‹ í”„ë¡œëª¨ì…˜ í˜ì´ì§€<br>
                                    â€¢ ê° ì¹´ë“œì‚¬ ê³µì‹ ì œíœ´ ì•ˆë‚´<br>
                                    â€¢ ìš´ì˜ì ì§ì ‘ ë“±ë¡ ë° ì—…ë°ì´íŠ¸<br>
                                    <br>
                                    <strong>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</strong> 2ì‹œê°„ ì „
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function generateAffiliateLink(route, hotelUrl) {
            const YOUR_AFFILIATE_ID = 'YOUR_AFFILIATE_ID_HERE';
            let baseUrl = hotelUrl.split('?')[0];
            
            if (route.type === 'payment') {
                if (route.card === 'shinhan') {
                    return `${baseUrl}?cid=shinhan&affid=${YOUR_AFFILIATE_ID}`;
                } else if (route.card === 'kb') {
                    return `${baseUrl}?cid=kb&affid=${YOUR_AFFILIATE_ID}`;
                } else if (route.card === 'naver') {
                    return `${baseUrl}?cid=naver&affid=${YOUR_AFFILIATE_ID}`;
                }
            } else if (route.type === 'coupon' && route.code) {
                return `${baseUrl}?affid=${YOUR_AFFILIATE_ID}&coupon=${route.code}`;
            }
            
            return `${baseUrl}?affid=${YOUR_AFFILIATE_ID}`;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰ (ë°ëª¨ìš©)
        // window.onload = () => analyzeUrl();
    </script>
</body>
</html>
